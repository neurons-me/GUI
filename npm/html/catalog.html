<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>this.GUI — Themes Catalog</title>
    <link
      rel="icon"
      href="https://res.cloudinary.com/dkwnxf6gm/image/upload/v1761276578/this.gui.npm.png"
    />

    <!-- Local CSS (expects this.gui.css next to this file in dist/) -->
    <link rel="stylesheet" href="./this.gui.css" />
    <link rel="stylesheet" href="./material-symbols.css" />
    <link rel="preload" href="./material-symbols-rounded.woff2" as="font" type="font/woff2" crossorigin />

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }

      /* Resilient even if CSS bundle is missing */
      #root {
        min-height: 100vh;
      }

      /* Simple fallback look in case GUI fails */
      .fallback {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        padding: 24px;
        max-width: 960px;
        margin: 0 auto;
      }
      .fallback code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <!-- React UMD globals (required by runtime mount) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react-jsx-runtime.production.min.js"></script>

    <!-- Local UMD build (expects this.gui.umd.js next to this file in dist/) -->
    <script src="./this.gui.umd.js"></script>

    <script>
      (function () {
        const GUI = window.GUI;
        const rootEl = document.getElementById('root');
        if (!rootEl) return;

        // Friendly diagnostics
        const fail = (msg) => {
          rootEl.innerHTML =
            '<div class="fallback">' +
            '<h2>❌ this.GUI runtime error</h2>' +
            '<p>' + msg + '</p>' +
            '<p>Make sure these files exist next to this HTML:</p>' +
            '<ul>' +
            '<li><code>this.gui.css</code></li>' +
            '<li><code>this.gui.umd.js</code></li>' +
            '<li><code>material-symbols-rounded.woff2</code> (font)</li>' +
            '</ul>' +
            '</div>';
        };

        if (!GUI) return fail('window.GUI not found. Did you load <code>this.gui.umd.js</code>?');
        if (typeof GUI.mount !== 'function') return fail('window.GUI exists, but <code>GUI.mount</code> is missing.');

        // Sidebar config
        const leftSidebarConfig = {
          initialView: 'rail',
          elements: [
            { type: 'link', props: { label: 'Home', icon: 'home', href: 'https://neurons-me.github.io/' } },
            { type: 'link', props: { label: 'all.this', icon: 'hub', href: 'https://neurons-me.github.io/all.this' } },
            { type: 'link', props: { label: '.GUI', icon: 'widgets', href: 'index.html' } },
            // Local runtime demos (work when browsing the /dist folder)
            { type: 'link', props: { label: 'Catalog (local)', icon: 'palette', href: './catalog.html' } },
            // Hosted pages
            { type: 'link', props: { label: 'Storybook', icon: 'auto_stories', href: 'https://neurons-me.github.io/GUI/storybook-static/' } },
          ],
        };

        // --- Example 1: Mount a “real” component directly (imperative / composable runtime)
        // This uses actual React components exported on window.GUI.
        //
        // NOTE: This expects `ThemesCatalog` to exist on window.GUI (it is exported from index.ts).
        // If your export is named slightly differently, adjust below.
        const ThemesCatalog =
          GUI.ThemesCatalog ||
          (GUI.Theme && (GUI.Theme.ThemesCatalog || GUI.Theme.Catalog || GUI.Theme.Catalogs)) ||
          (GUI.theme && (GUI.theme.ThemesCatalog || GUI.theme.Catalog || GUI.theme.Catalogs)) ||
          null;

        // --- Example 2: Render the same view from a JSON spec (declarative runtime)
        // This proves the renderer resolves "type" strings against the UMD surface.
        const jsonSpec = {
          type: 'Box',
          props: {
            sx: {
              mt: 2,
              p: 2,
              borderRadius: 2,
              border: '1px dashed rgba(255,255,255,0.18)',
              background: 'rgba(0,0,0,0.12)',
            },
          },
          children: [
            {
              type: 'Typography',
              props: { variant: 'subtitle2', sx: { mb: 1 } },
              children: ['Example 2 — Declarative spec (JSON → renderer → ThemesCatalog)'],
            },
            {
              // Render declaratively via the renderer.
              // We use a dynamic `type` so it works even if the catalog is exported under Theme.*
              type: (ThemesCatalog && 'ThemesCatalog') || 'Theme.ThemesCatalog',
              props: {
                variant: 'grid',
                minimal: true,
              },
            },
          ],
        };

        const pageSpec = {
          type: 'Layout',
          props: { leftSidebarConfig },
          children: [
            {
              type: 'Page',
              props: {
                title: 'this.GUI — Themes Catalog',
                subtitle: 'A UMD runtime page that mounts components directly + via JSON spec.',
              },
              children: [
                {
                  type: 'Box',
                  props: {
                    sx: {
                      mt: 2,
                      display: 'grid',
                      gridTemplateColumns: { xs: '1fr', md: '1fr 1fr' },
                      gap: 2,
                      alignItems: 'start',
                    },
                  },
                  children: [
                    // Left column: imperative + declarative stacked
                    {
                      type: 'Box',
                      props: {
                        sx: {
                          display: 'flex',
                          flexDirection: 'column',
                          gap: 2,
                        },
                      },
                      children: [
                        // Example 1 (Imperative)
                        {
                          type: 'Box',
                          props: {
                            sx: {
                              p: 2,
                              borderRadius: 2,
                              border: '1px solid rgba(255,255,255,0.12)',
                              background: 'rgba(0,0,0,0.08)',
                            },
                          },
                          children: [
                            {
                              type: 'Typography',
                              props: { variant: 'subtitle2', sx: { mb: 1 } },
                              children: ['Example 1 — Imperative mount (direct component)'],
                            },
                            {
                              type: 'Typography',
                              props: { variant: 'caption', sx: { display: 'block', mb: 1.5, opacity: 0.8 } },
                              children: [
                                'This mounts the catalog by calling React.createElement on the exported ThemesCatalog component.',
                              ],
                            },
                            {
                              type: 'Box',
                              props: {
                                sx: {
                                  borderRadius: 2,
                                  overflow: 'hidden',
                                  border: '1px solid rgba(255,255,255,0.12)',
                                },
                              },
                              // We will replace this node at runtime with the actual React element if ThemesCatalog exists.
                              children: [
                                {
                                  type: 'Box',
                                  props: {
                                    sx: {
                                      p: 2,
                                      opacity: 0.9,
                                      fontFamily:
                                        'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',
                                      fontSize: 12,
                                    },
                                  },
                                  children: [
                                    'Waiting for ThemesCatalog... (if you see this, the export name may be different)',
                                  ],
                                },
                              ],
                            },
                          ],
                        },

                        // Example 2 (Declarative)
                        {
                          type: 'Box',
                          props: {
                            sx: {
                              p: 2,
                              borderRadius: 2,
                              border: '1px solid rgba(255,255,255,0.12)',
                              background: 'rgba(0,0,0,0.08)',
                            },
                          },
                          children: [
                            {
                              type: 'Typography',
                              props: { variant: 'subtitle2', sx: { mb: 1 } },
                              children: ['Example 2 — Declarative spec (JSON → renderer → ThemesCatalog)'],
                            },
                            {
                              type: 'Typography',
                              props: { variant: 'caption', sx: { display: 'block', mb: 1.5, opacity: 0.8 } },
                              children: [
                                'This mounts the catalog using a JSON spec, resolved through the UMD registry.',
                              ],
                            },
                            {
                              type: 'Box',
                              props: {
                                sx: {
                                  borderRadius: 2,
                                  overflow: 'hidden',
                                  border: '1px solid rgba(255,255,255,0.12)',
                                },
                              },
                              children: [jsonSpec],
                            },
                          ],
                        },
                      ],
                    },

                    // Right column: only the JSON code
                    {
                      type: 'Box',
                      props: {
                        sx: {
                          p: 2,
                          borderRadius: 2,
                          border: '1px solid rgba(255,255,255,0.12)',
                          background: 'rgba(0,0,0,0.08)',
                        },
                      },
                      children: [
                        {
                          type: 'CodeBlock',
                          props: {
                            title: 'themes.catalog.spec.json',
                            language: 'json',
                            variant: 'dark',
                            showLineNumbers: true,
                            wrapLongLines: true,
                            code: '',
                          },
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        };

        // Inject JSON into CodeBlock (first node on right column)
        try {
          const json = JSON.stringify(jsonSpec, null, 2);
          const codeBlockNode = pageSpec?.children?.[0]?.children?.[0]?.children?.[1]?.children?.[0];
          if (codeBlockNode && codeBlockNode.type === 'CodeBlock') {
            codeBlockNode.props.code = json;
          }
        } catch (e) {
          // ignore
        }

        // Replace the placeholder box in Example 1 with the real ThemesCatalog element
        // We do it by turning that placeholder node into a raw React element (supported by renderer).
        try {
          if (window.React) {
            // Locate the placeholder Box inside Example 1 container
            const leftColumn = pageSpec?.children?.[0]?.children?.[0]?.children?.[0];
            const example1Container = leftColumn?.children?.[0];
            const previewBox = example1Container?.children?.[2];
            if (previewBox) {
              if (ThemesCatalog) {
                // Direct React component mount (imperative)
                previewBox.children = [window.React.createElement(ThemesCatalog, { key: 'themes-catalog', variant: 'grid', minimal: true })];
              } else {
                // Fallback: try rendering declaratively via registry string
                previewBox.children = [
                  {
                    type: 'ThemesCatalog',
                    props: { variant: 'grid', minimal: true },
                  },
                ];
              }
            }
          }
        } catch (e) {
          // ignore
        }

        try {
          console.log('[this.GUI] Keys:', Object.keys(GUI));
          console.log('[this.GUI] Theme keys:', GUI.Theme ? Object.keys(GUI.Theme) : null);
          console.log('[this.GUI] ThemesCatalog export:', ThemesCatalog);
        } catch (e) {}

        // Mount via this.GUI runtime (providers are handled by mount.ts)
        try {
          GUI.mount(pageSpec, '#root', { showUnknown: true });
        } catch (err) {
          const msg = err && err.message ? err.message : String(err);
          fail('mount failed: ' + msg);
        }
      })();
    </script>
  </body>
</html>
